

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<body>
	<center>
 
<div id="viz"></div>
	<%=javascript_tag do%>
	var height = 600;
	var width = 1200;

		var svg = d3.select("#viz")
        .append("svg")
        .attr("width", width)
        .attr("height", height);  

        circleData = [{text:<%=@scorex%>,r:60,cx:width/2,cy:height/2},
        			 {text:<%=@payments_recieved%>,r:40,cx:900,cy:100},
        			 {text:<%=@drugs_prescribed%>,r:40,cx:900,cy:400},
        			 {text:<%=@rating%>,r:30,cx:300,cy:400}]

        var scoreCircle = svg.append("g").selectAll("circle")
    .data(circleData)
    .enter()
    scoreCircle.
    append("circle")
    .style("stroke", "gray")
    .style("stroke-width","7")
    .style("fill", "transparent")
    .attr("r", function(d){return d.r;})
    .attr("cx", function(d){return d.cx;})
    .attr("cy", function(d){return d.cy;});

    
    scoreCircle.append("text")
    .attr("text-anchor", "middle")
    .text(function(d) {
       return d.text;
      })
    .attr("x", function(d){return d.cx - 2;})
    .attr("y", function(d){return d.cy + 5;});

    var asset_arr = [{img:"/assets/right_arrow.png",x:640,y:80},
    				 {img:"/assets/left_arrow.png",x:350,y:80},
    				 {img:"/assets/left_bottom_arrow.png",x:350,y:290},
    				 {img:"/assets/right_bottom_arrow.png",x:640,y:290}];
  
    var imgs = svg.selectAll("image").data(asset_arr);
            imgs.enter()
            .append("svg:image")
                 .attr("xlink:href", function(d){return d.img;})
                .attr("x", function(d){return d.x;})
                .attr("y", function(d){return d.y;})
                .attr("width", "200")
                .attr("height", "200");



               var colors = ['#0000b4','#0082ca','#0094ff','#0d4bcf','#0066AE']

      var colorScale = d3.scale.quantize()
						.domain([0,5])
						.range(colors);
    
     var xscale = d3.scale.linear()
						.domain([<%= @payments.min() -1%>, <%=@payments.max()+1%>])
						.range([0,200]);

		var yscale = d3.scale.linear()
						.domain([0,4])
						.range([0,100]);

		var chart = svg.append('g')
							.attr("transform", "translate(1000,10)")
							.attr('id','bars')
							.selectAll('rect')
							.data(<%= @payments %>)
							.enter()
							.append('rect')
							.attr('height',19)
							.attr({'x':0,'y':function(d,i){ return yscale(i)+19; }})
							.style('fill',function(d,i){ return colorScale(i); });
							<!-- .attr('width',function(d){ return 0; }); -->
		var transit = d3.select("svg").selectAll("rect")
						    .data(<%= @payments %>)
						    .transition()
						    .duration(1000) 
						    .attr("width", function(d) {return xscale(d); });

		var transitext = d3.select('#bars')
							.selectAll('text')
							.data(<%= @payments %>)
							.enter()
							.append('text')
							.attr({'x':function(d) {return xscale(d)-200; },'y':function(d,i){ return yscale(i)+35; }});


	<% end %>
	</center>
	
</body>